<!DOCTYPE html>
<html lang="en">

<head>
  <title>Predicted COVID Test Performance</title>
  <link rel="stylesheet" href="/stylesheets/style.css">
</head>

<body>
  <header>
    <h1>Learning from COVID-19 Viral Loads</h1>
    <h3>How viral loads vary&mdash;or don&apos;t&mdash;across patients can predict the performance
      to antigen tests in different groups</h3>
    <p class="intro" >
      COVID-19 test results are usually reported simply as &ldquo;positive&rdquo; or &ldquo;negative&rdquo;. However,
      the amount of virus a person produces&mdash;the <strong>viral load</strong>&mdash;can very.</p>
    <p class="intro">We estimated viral
      load for over <strong>40,000 patients</strong> who had a positive PCR test at our hospital from 2020-2023 so you can
      see how viral loads vary&mdash;or don&apos;t&mdash;across age, sex, and so on.
    </p>
  </header>
  <div class="webapp" >
    <div class="pickgroup has_bottom_line">
      <fieldset id="select_var" class="select_var_closed">
        <legend id="select_var_label">Explore group(s)
	  <svg height="10" width="10" >
	    <line x1="0" y1="0" x2="10" y2="5" stroke="black" />
	    <line x1="10" y1="5" x2="0" y2="10" stroke="black" />
	  </svg>
	</legend>
	<div id="select_var_checks">
	  <strong>Group</strong>
	  <button id="resetChecks" class="bluebutton" >Reset</button>
	</div>
      </fieldset>
    </div>
    <div class="grouphisto has_bottom_line">
      <h1 id="comparison_title" class="comparisons" ></h1>
      <svg id="displaybox" class="displaybox" width="100%" height="400" >
	<!-- D3 does its thing here -->
      </svg>
      <div class="meantext">
	<div id="pvalue_text" >
	</div>
	<div id="commentary"></div>
      </div>
      <div id="pyramid_container" class="pyramid" >
	<svg id="pyramid" width="100%" ></svg>
      </div>
      <div class="savebuttons">
	<span></span>
	<a href="notyet" target="_blank" class="download"> Save plot </a>
	<a href="dataset" download class="download"> Download De-identified Dataset </a>
      </div>
    </div>
    <div class="pickanti has_bottom_line">
      <div class="antigen_text">
	<h3>Antigen Tests</h3>
	Lorem ipsum dolor sit amet, <strong>consectetur</strong> adipiscing elit, sed do eiusmod tempor <strong>incididunt</strong> ut labore et dolore magna aliqua.
      </div>
      <fieldset class="select_test no_border">
        <legend class="select_label_antigen" >Antigen Test</legend>
        <select class="select_antigen" name="antigenTest" id="antigenTest" >
          <option value="none" selected>-- no test selected --</option>
        </select>
      </fieldset>
      <fieldset class="select_lod no_border" >
	<legend>Limit of Detection (LOD)</legend>
	<input type="range" min="-1" max="12" value="-1" class="slider" id="lod_slider">
	<span id="lod_text">
	  10<sup id="lod_exp"></sup> copies/ML
	</span>
      </fieldset>
    </div>
    <hr/>
    <div class="antihisto">
      <h1 class="antihisto_title">
	Performance of <span id="test_description"></span>
      </h1>
      <div class="group_radio" id="group_radio" ></div>
      <svg id="antiperf" class="antiperf">
      </svg>
      <div class="performance_commentary">
      </div>
      <div class="savebuttons">
	<span></span>
	<span></span>
	<a href="notyet" target="_blank" class="download"> Save plot </a>
      </div>
    </div>
  </div>
  <hr/>
  <details id="moresettings">
    <summary>Show More Settings</summary>
    <div class="indent">
      Scaling on y axes:
      <input type="radio" id="scale_absolute" name="y_scale" value="scale_absolute" checked="checked">
      <label for="scale_absolute">Counts&mdash;Independent</label>
      <input type="radio" id="scale_shared" name="y_scale" value="scale_shared">
      <label for="scale_shared">Counts&mdash;Shared</label>
    </div>
    <div class="indent">
      <label for="infectivityThreshold" name="infectivityThreshold">Infectivity Threshold:</label>
      <input type="range" min="0" max="12" value="5" class="slider" id="infectivityThreshold">
    </div>
  </details>
  <hr/>
</body>
<script type="module">
  import { setInfectivityThreshold, presentData,
	   resetChecks} from './javascripts/histo.js';

  document.getElementById("resetChecks").onclick = resetChecks;
  document.getElementById("select_var_label").onclick = toggleParent;

  function toggleParent(event) {
      let parent = event.target.parentNode;
      while (true) {
	  if (parent.className == "select_var_closed") {
	      parent.className = "select_var_open";
	      return;
	  }
	  else if (parent.className == "select_var_open") {
	      parent.className = "select_var_closed";
	      return;
	  }
	  else {
	      parent = parent.parentNode;
	  }
      }	  
  }

  function updateThreshold(event) {
    let newValue = event.target.value;
    setInfectivityThreshold(newValue);
  }
  document.getElementById("infectivityThreshold").oninput = updateThreshold;
  setInfectivityThreshold(document.getElementById("infectivityThreshold").value);

  function updateScaleOption(event) {
      presentData();
  }
  document.getElementById("scale_absolute").onchange = updateScaleOption;
  document.getElementById("scale_shared").onchange = updateScaleOption;

</script>
</html>
