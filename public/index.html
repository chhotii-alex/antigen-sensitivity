<!DOCTYPE html>
<html lang="en">

<head>
  <title>Predicted COVID Test Performance</title>
  <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
  <link href="https://arnaoutlab.org/style4.css" rel="stylesheet" />
  <link rel="stylesheet" href="/stylesheets/style.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100;8..144,300;8..144,400;8..144,500;8..144,600;8..144,700;8..144,800&display=swap');
  </style>

</head>

<body>
  <div id="loading" >
    <img src="virus.gif" >
  </div>

  <div id="menu">
        <ul id="menu">
          <li>
              <a class="no-change" href="#top">Arnaout Laboratory for Immunomics and Informatics</a>
          </li>
          <ul id="topmenu">
              <li>
                <a href="#publications">Publications</a>
              </li>
              <li>
                <a href="#team">Team</a>
              </li>
              <li>
                <a href="#contribute">Contribute</a>
              </li>
          </ul>
        </ul>
      </div>

  
  <div class="savebuttons">
    <a href="dataset" download class="download"> Download de-identified dataset </a>
  </div>
  <header>
    <h1>Learning from COVID-19 Viral Loads</h1>

    <h2>How viral loads vary&mdash;or don&apos;t&mdash;across patients can predict the performance
      of antigen tests in different groups</h2>

    <p class="body_text" >
      COVID-19 test results are usually reported simply as &ldquo;positive&rdquo; or &ldquo;negative.&rdquo; However,
      the amount of virus a person produces&mdash;the <span class="bold">viral load</span>&mdash;can vary. We estimated viral
      load for over <span class="bold">40,000 patients</span> who had a positive PCR test at our hospital from 2020-2023 so you can
      see how viral loads vary&mdash;or don&apos;t&mdash;across age, sex, and so on.
    </p>
  </header>
  <div class="webapp" >
    <div class="pickgroup has_bottom_line">
      <fieldset class="select_var_closed">
        <legend id="select_var_label">Explore groups
	  <svg height="20" width="14" overflow="visible" >
	    <g transform="translate(4,8)">
	      <line x1="0" y1="0" x2="5" y2="6" stroke="black" stroke-width="3" stroke-linecap="round" />
	      <line x1="5" y1="6" x2="0" y2="12" stroke="black" stroke-width="3" stroke-linecap="round" />
	    </g>
	  </svg>
	</legend>
	<div id="select_var" >
	  <div id="select_var_checks">
	    <strong>Group</strong>
	    <button id="resetChecks" class="bluebutton" >Reset</button>
	  </div>
	</div>
      </fieldset>
    </div>
    <div id="grouphisto" class="grouphisto has_bottom_line">
      <h1 id="comparison_title" class="comparisons" ></h1>
      <svg id="displaybox" class="displaybox">
 	<!-- D3 does its thing here -->
      </svg>
      <div class="meantext">
	<div id="pvalue_text" >
	<div id="commentary"></div>
	</div>
      </div>
      <div id="pyramid_container" class="pyramid" >
	<svg id="pyramid" width="100%" ></svg>
      </div>
      <div class="plegend" >
	<p class="plengend_text">
	  Each entry in this triangle plot shows the p-value for the difference in viral load between the indicated groups. (The statistical test is the Mann-Whitney U test.) Brighter entries indicate greater differences.
	</p>
        <img id="plegend" src="plegend.jpg" width="150px" height="50px" />
      </div>
    </div>
  </div>
      <div class="antigen_text">
	<h3>Antigen Tests</h3>
	<p class="body_text">Antigen tests can be self-administered and used at home but are less sensitive than PCR tests. For the antigen tests in the pulldown menu below, the antigen test and a PCR test have been run at the same time on the same people. This real-world data can <span class="bold">predict how well these antigen tests will perform</span> on different groups <span class="bold">without having to run time-consuming and expensive trials</span> on each group selected above.</p>
	<p class="body_text">When paired trials that directly compare an antigen test to PCR have not been performed, we can still predict how sensitive an antigen test is for detecting contagiousness by using the antigen test’s limit of detection (LOD). If the antigen test you’re looking for does not appear in the dropdown, <span class="bold">set the LOD to see how sensitive your antigen test is.</span></p>
      </div>
  <div class="pickanti has_bottom_line">
      <fieldset class="select_test no_border">
        <legend class="select_label_antigen" >Antigen Test</legend>
        <select class="select_antigen" name="antigenTest" id="antigenTest" >
          <option value="none" selected>-- select one --</option>
        </select>
      </fieldset>
      <fieldset class="select_lod no_border" >
	<legend>Limit of detection (LOD)</legend>
	<input type="range" min="-1" max="12" value="-1" class="slider" id="lod_slider">
	<span id="lod_text">
	  10<sup id="lod_exp"></sup> copies/mL
	</span>
      </fieldset>
  </div>
  <hr/>
  <div class="antihisto hidden_style" id="antihisto">
      <div class="antihisto_title">
	<h1>
	  Performance of <span id="test_description"></span>
	</h1>
      </div>
      <div class="group_radio" id="group_radio" ></div>
      <svg id="antiperf" class="antiperf">
      </svg>
      <div class="performance_commentary">
      </div>
  </div>
  <hr/>
  <details id="moresettings">
    <summary>Show More Settings</summary>
    <div class="indent">
      Scaling on y axes:
      <input type="radio" id="scale_absolute" name="y_scale" value="scale_absolute" checked="checked">
      <label for="scale_absolute">Counts&mdash;Independent</label>
      <input type="radio" id="scale_shared" name="y_scale" value="scale_shared">
      <label for="scale_shared">Counts&mdash;Shared</label>
    </div>
    <div class="indent">
      <label for="infectivityThreshold" name="infectivityThreshold">Infectivity Threshold:</label>
      <input type="range" min="0" max="12" value="5" class="slider" id="infectivityThreshold">
    </div>
  </details>
  <hr/>
  <footer>
    <h2>Tell us what you think!</h2>
    We appreciate your feedback. Please email us at
    <a href="mailto:rarnaout@bidmc.harvard.edu">rarnaout@bidmc.harvard.edu</a>.
  </footer>
</body>
<script type="module">
  import { setInfectivityThreshold, presentData,
	   resetChecks} from './javascripts/histo.js';

  document.getElementById("resetChecks").onclick = resetChecks;
  document.getElementById("select_var_label").onclick = toggleParent;

  function toggleParent(event) {
      let parent = event.target.parentNode;
      while (true) {
	  if (parent.className == "select_var_closed") {
	      parent.className = "select_var_open";
	      return;
	  }
	  else if (parent.className == "select_var_open") {
	      parent.className = "select_var_closed";
	      return;
	  }
	  else {
	      parent = parent.parentNode;
	  }
      }	  
  }

  function updateThreshold(event) {
    let newValue = event.target.value;
    setInfectivityThreshold(newValue);
  }
  document.getElementById("infectivityThreshold").oninput = updateThreshold;
  setInfectivityThreshold(document.getElementById("infectivityThreshold").value);

  function updateScaleOption(event) {
      presentData();
  }
  document.getElementById("scale_absolute").onchange = updateScaleOption;
  document.getElementById("scale_shared").onchange = updateScaleOption;

</script>
</html>
