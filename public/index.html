<!DOCTYPE html>
<html lang="en">

<head>
  <title>Predicted COVID Test Performance</title>
  <link rel="stylesheet" href="/stylesheets/style.css">
</head>

<body>
  <h1>SARS-CoV-2 Viral Loads and Test Performance by Group</h1>
  <h3>How viral loads vary across groups and predict antigen-test sensitivity</h3>
  <p class="intro" >
    COVID-19 test results are usually reported simply as "positive" or "negative". However,
    the amount of virus a person sheds&mdash;the viral load&mdash;can very. We estimated viral
    load for every patient who had a positive PCR test at our hospital from 2020-2023 so you can
    see how viral loads vary&mdash;or don't&mdash;across age, sex, and so on.
  </p>
  <div class="webapp" >
    <div class="settings">
      <fieldset class="select_antigen">
        <legend class="select_label select_label_antigen" >Test</legend>
        <select class="select_antigen" name="antigenTest" id="antigenTest" onchange="selectAction()">
          <option value="none" selected>-- no test selected --</option>
        </select>
      </fieldset>
      <fieldset>
	<legend>Limit of Detection (LOD)</legend>
	<input type="range" min="0" max="12" value="5" class="slider" id="lod_slider">
	10<sup id="lod"></sup> copies/ML
      </fieldset>
      <fieldset class="select_var">
        <legend class="select_label select_label_var" >Group</legend>
	<button id="resetChecks" class="bluebutton" >Reset</button>
	<div id="select_var_checks">
	</div>
      </fieldset>
    </div>
    <div class="output">
	<div id="comparisons">
	</div>
	<br/>
	<svg id="displaybox" width="100%" height="400" >
	  <!-- D3 does its thing here -->
	</svg>
	<br/>
	<div class="savebuttons">
	  <span></span>
	  <a href="notyet" target="_blank" class="download"> Save plot </a>
	  <a href="dataset" download class="download"> Download De-identified Dataset </a>
	</div>
	<div id="pyramid_container" >
	  <svg id="pyramid" width="100%" >
	</div>
	</svg>
	<div id="commentary"></div>
    </div>
  </div>
  <details id="moresettings">
    <summary>Show More Settings</summary>
    <div class="indent">
      Scaling on y axes:
      <input type="radio" id="scale_absolute" name="y_scale" value="scale_absolute" checked="checked">
      <label for="scale_absolute">Counts&mdash;Independent</label>
      <input type="radio" id="scale_shared" name="y_scale" value="scale_shared">
      <label for="scale_shared">Counts&mdash;Shared</label>
    </div>
    <div class="indent">
      <label for="infectivityThreshold" name="infectivityThreshold">Infectivity Threshold:</label>
      <input type="range" min="0" max="13" value="5" class="slider" id="infectivityThreshold">
    </div>
  </details>
  <hr/>
</body>
<script type="module">
  import { setInfectivityThreshold, presentData, resetChecks } from './javascripts/histo.js';

  document.getElementById("resetChecks").onclick = resetChecks;

  function updateThreshold(event) {
    let newValue = event.target.value;
    setInfectivityThreshold(newValue);
  }
  document.getElementById("infectivityThreshold").oninput = updateThreshold;
  setInfectivityThreshold(document.getElementById("infectivityThreshold").value);

  let lod_slider = document.getElementById("lod_slider");
  lod_slider.oninput = function() {
      let lod = this.value;
      updateLOD(lod);
  }
  function updateLOD(lod) {
      let lod_text = document.getElementById("lod");
      lod_text.innerHTML = lod;
  }
  updateLOD(lod_slider.value);
  
  function updateScaleOption(event) {
      presentData();
  }
  document.getElementById("scale_absolute").onchange = updateScaleOption;
  document.getElementById("scale_shared").onchange = updateScaleOption;

</script>
</html>
